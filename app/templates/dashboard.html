<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üèÅ F1 Friends | Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="logo">üèÅ F1 Dashboard</div>
    <div class="nav-links">
      <a href="{{ url_for('main.chatbot') }}">ü§ñ AI Chatbot</a>
      <a href="{{ url_for('main.profile') }}">üë§ Profile</a>
    </div>
  </div>

  <!-- Dashboard Container -->
  <div class="dashboard-container">
    <!-- Team Card (You can replace this with user's favorite team info if needed) -->
    <div class="card team-card">
      <h2>Your F1 Team</h2>
      {% if favorite_team and team_info %}
      <div class="team-logo-name">
        <img src="{{ team_logo }}" alt="{{ favorite_team }} Logo" class="team-logo">
        <div class="team-name">{{ favorite_team }}</div>
      </div>
      <div class="team-points">
        <span>Track Your Team's Performance</span>
        <div style="display: flex; gap: 2rem;">
          <p><strong>Position:</strong> {{ team_info.position }}</p>
          <p><strong>Points:</strong> {{ team_info.points }}</p>
          <p><strong>Wins:</strong> {{ team_info.wins }}</p>
        </div>
      </div>
      {% else %}
      <div class="team-name">No favorite team selected.</div>
      {% endif %}
    </div>

    <!-- Standings -->
    <div class="card">
      <h2>Top 5 Drivers</h2>
      <ul>
        {% for driver in standings[:5] %}
          <li>{{ driver.driver.name }} ‚Äî {{ driver.points }} pts</li>
        {% else %}
          <li>No driver data found.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Standings Chart -->
<div class="card">
  <h2>Driver Standings Chart</h2>
  <canvas id="standingsChart"></canvas>
</div>

<!-- Add Chart.js via CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('standingsChart').getContext('2d');

  const driverNames = {{ standings[:5]|map(attribute='driver.name')|list|tojson }};
  const driverPoints = {{ standings[:5]|map(attribute='points')|list|tojson }};

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: driverNames,
      datasets: [{
        label: 'Points',
        data: driverPoints,
        backgroundColor: [
          'rgba(255, 99, 132, 0.8)',
          'rgba(255, 159, 64, 0.8)',
          'rgba(54, 162, 235, 0.8)',
          'rgba(75, 192, 192, 0.8)',
          'rgba(153, 102, 255, 0.8)'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Top 5 F1 Drivers ‚Äî 2025 Standings'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { color: 'white' },
          grid: { color: 'rgba(255,255,255,0.1)' }
        },
        x: {
          ticks: { color: 'white' },
          grid: { color: 'rgba(255,255,255,0.1)' }
        }
      }
    }
  });
</script>

<!-- Static Chart Image (Matplotlib) -->
<div class="card">
  <h2>Static Standings Chart</h2>
  <img src="{{ url_for('static', filename='charts/standings.png') }}" alt="Static Standings Chart" class="standings-img">
</div>

    <!-- Next Race -->
    {% if next_race %}
      <div class="card">
        <h2>Next Race</h2>
        <p>
          <strong>{{ next_race.race.raceName }}</strong><br>
          {{ next_race.race.date }} ‚Äî {{ next_race.race.circuit.location.locality }}
        </p>
      </div>
    {% else %}
      <div class="card">
        <h2>Next Race</h2>
        <p>No upcoming race data available.</p>
      </div>
    {% endif %}
  </div>

  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
