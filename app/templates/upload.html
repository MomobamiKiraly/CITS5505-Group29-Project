<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Upload Prediction</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .team,
        .driver {
            border: 2px solid transparent;
            transition: 0.3s;
            cursor: pointer;
        }

        .selected {
            border-color: #007bff;
        }
    </style>
</head>

<body class="bg-light p-5">
    <div class="container bg-white p-4 shadow rounded">
        <h2>Upload Your F1 Prediction</h2>
        <form method="POST">
            <div class="step active" id="step1">
                <h4>Step 1: Personal Info</h4>
                <input class="form-control mb-2" type="text" name="full_name" placeholder="Full Name" required>
                <input class="form-control mb-2" type="number" name="age" placeholder="Age" required>
                <input class="form-control mb-2" type="text" name="country" placeholder="Country">
                <button class="btn btn-primary mt-2" type="button" onclick="nextStep()">Next</button>
            </div>

            <div class="step" id="step2">
                <h4>Step 2: Choose Team</h4>
                <div class="row text-center">
                    {% for team in teams %}
                    <div class="col-6 mb-3">
                        <img src="{{ team.image_url }}" class="team img-fluid p-2" onclick="selectTeam(this)"
                            data-value="{{ team.name }}">
                    </div>
                    {% endfor %}
                </div>
                <input type="hidden" name="team" id="teamInput">
                <h4 class="mt-4">Choose Driver</h4>
                <div class="row text-center" id="driverContainer"></div>
                <input type="hidden" name="driver" id="driverInput">
                <button class="btn btn-secondary mt-2" type="button" onclick="prevStep()">Back</button>
                <button class="btn btn-primary mt-2" type="button" onclick="nextStep()">Next</button>
            </div>

            <div class="step" id="step3">
                <h4>Step 3: Predictions</h4>
                <input class="form-control mb-2" type="text" name="race_winner" placeholder="Race winner" required>
                <input class="form-control mb-2" type="text" name="top_3" placeholder="Top 3 (comma-separated)"
                    required>
                <input class="form-control mb-2" type="text" name="fastest_lap" placeholder="Fastest lap driver"
                    required>
                <button class="btn btn-secondary" type="button" onclick="prevStep()">Back</button>
                <button class="btn btn-success" type="submit">Submit</button>
            </div>
        </form>
    </div>

    <script>
        let current = 0;
        const steps = document.querySelectorAll('.step');
        const driversByTeam = {{ drivers_by_team | tojson }};

        function nextStep() {
            if (current < steps.length - 1) {
                steps[current].classList.remove('active');
                current++;
                steps[current].classList.add('active');
            }
        }
        function prevStep() {
            if (current > 0) {
                steps[current].classList.remove('active');
                current--;
                steps[current].classList.add('active');
            }
        }
        function selectTeam(el) {
            document.querySelectorAll('.team').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('teamInput').value = el.dataset.value;
            updateDrivers(el.dataset.value);
        }

        function updateDrivers(teamName) {
            const driverContainer = document.getElementById('driverContainer');
            driverContainer.innerHTML = '';
            if (driversByTeam[teamName]) {
                driversByTeam[teamName].forEach(driver => {
                    const col = document.createElement('div');
                    col.className = 'col-6 mb-2';

                    const img = document.createElement('img');
                    img.src = driver.image_url;
                    img.alt = driver.name;
                    img.className = 'driver img-fluid p-2';
                    img.setAttribute('data-value', driver.name);
                    img.onclick = function () {
                        document.querySelectorAll('.driver').forEach(d => d.classList.remove('selected'));
                        img.classList.add('selected');
                        document.getElementById('driverInput').value = driver.name;
                    };

                    col.appendChild(img);
                    driverContainer.appendChild(col);
                });
            }
        function selectItem(el, type) {
            document.querySelectorAll('.' + type).forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById(type + 'Input').value = el.dataset.value;
        }
    }
    </script>
</body>

</html>
