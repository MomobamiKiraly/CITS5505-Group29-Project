<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ user.username }}'s Profile</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
</head>
<body>

  {% if user.id == current_user.id %}
  <div class="navbar">
    <div class="nav-links">
      <a href="{{ url_for('main.dashboard') }}">Go to Dashboard</a> |
      <a href="{{ url_for('main.friends') }}">ğŸ‘¥ Friends</a> |
      <a href="{{ url_for('main.chatbot') }}">ğŸ¤– AI Chatbot</a>
      <a href="{{ url_for('main.logout') }}">Logout</a>
    </div>
  </div>
  {% endif %}

  <div class="container">
    <div class="header">
      <img
        src="{{ url_for('static', filename='profile_pics/' + (user.profile_pic if user.profile_pic else 'default.jpg')) }}"
        alt="Profile Picture">
      <div class="header-info">
        <h2>{{ user.username }}</h2>
        <p>Email: {{ user.email }}</p>
        {% if user.bio %}
        <p><em>{{ user.bio }}</em></p>
        {% endif %}
      </div>
      <div class="follow-btn">
        {% if user.id != current_user.id %}
        {% if is_following %}
        <a href="{{ url_for('main.unfollow', user_id=user.id) }}">Unfollow</a>
        {% else %}
        <a href="{{ url_for('main.follow', user_id=user.id) }}">Follow</a>
        {% endif %}
        {% else %}
        <a href="{{ url_for('main.edit_profile') }}">Edit</a>
        {% endif %}
      </div>
    </div>

    <div class="container">
      <!-- Tab Buttons -->
      <div class="toggle-group">
        <button class="toggle-btn" onclick="showSection('blog')">ğŸ“ Blog</button>
        <button class="toggle-btn" onclick="showSection('next-race')">ğŸ Next Race</button>
        <button class="toggle-btn" onclick="showSection('prediction')">ğŸ“Š My Prediction</button>
        <button class="toggle-btn" onclick="showSection('fav-driver')">ğŸš— Favorite Driver</button>
        <button class="toggle-btn" onclick="showSection('fav-team')">ğŸ Favorite Team</button>
      </div>

      <!-- Blog Section -->
      <div id="blog" class="section-tab">
        {% if user.id == current_user.id %}
        <div class="blog-form">
          <form method="POST">
            <input type="text" name="title" placeholder="What's on your mind?" required>
            <textarea name="content" placeholder="Write your blog..." required></textarea>
            <label class="checkbox-label">
              <input type="checkbox" name="is_public" id="is_public" checked>
              Make public
            </label>
            <button type="submit">Post</button>
          </form>
        </div>
        {% endif %}

        {% if posts %}
        {% for post in posts %}
        <div class="blog-post">
          <h3>{{ post.title }}</h3>
          <small>{{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
          <p>{{ post.content }}</p>
          {% if not post.is_public %}
          <span class="badge-private">Followers Only</span>
          {% endif %}
        </div>
        {% endfor %}
        {% else %}
        <p style="color: #888;">No blog posts yet.</p>
        {% endif %}
      </div>

      <!-- Next Race Section -->
      <div id="next-race" class="section-tab">
        <div class="blog-post">
          <h4>Next Race: {{ predictions[0].race_name if predictions else "Unnamed Race" }}</h4>

        </div>
      </div>

      <!-- My Prediction Section -->
      <div id="prediction" class="section-tab">
        <h4>Your Predictions</h4>
        <div class="follow-btn">
          <a href="{{ url_for('main.upload') }}" class="btn btn-danger">Make Prediction</a>
        </div>
        {% if predictions %}
        <ul>
          {% for prediction in predictions %}
          <li>ğŸ Race Winner: {{ prediction.predicted_winner or "Not set" }}</li>
          <li>âš¡ Fastest Lap: {{ prediction.fastest_lap or "Not set" }}</li>
          {% endfor %}
        </ul>
        {% else %}
        <p style="color: #888;">No predictions yet.</p>
        {% endif %}
      </div>
      
      <div class="profile-section">
        <!-- Favorite Driver Section -->
        <div id="fav-driver" class="section-tab">
          <h3>ğŸï¸ Favorite Driver</h3>

          {% if driver %}
          <div class="driver-info-card-horizontal">
            <div class="driver-photo-block">
              <h4>{{ driver.givenName }} {{ driver.familyName }}</h4>
              {% if driver_image %}
              <img src="{{ driver_image }}" alt="{{ driver.givenName }} {{ driver.familyName }}"
                class="driver-photo-large">
              {% endif %}
            </div>
            <div class="driver-details">
              <ul>
                <li><strong>Nationality:</strong> {{ driver.nationality }}</li>
                <li><strong>Date of Birth:</strong> {{ driver.dateOfBirth }}</li>
                <li><strong>Championship Position:</strong> {{ driver.position or 'â€”' }}</li>
                <li><strong>Points:</strong> {{ driver.points or 'â€”' }}</li>
                <li><strong>Wins:</strong> {{ driver.wins or 'â€”' }}</li>
                <li><strong>URL:</strong>
                  <a href="{{ driver.url }}" target="_blank" rel="noopener noreferrer">{{ driver.url }}</a>
                </li>
              </ul>
            </div>
          </div>
          {% else %}
          <p>{{ user.favorite_driver or "No favorite driver set." }}</p>
          {% endif %}
        </div>

        <!-- Favorite Team Section -->
        <div id="fav-team" class="section-tab">
          <h3>ğŸ Favorite Team</h3>

          {% if team %}
          <div class="team-info-card-horizontal">
            <div class="team-photo-block">
              <h4>{{ team.name | default(user.favorite_team) }}</h4>
              {% if team_image %}
              <div class="team-img-block">
                <img src="{{ team_image }}" alt="{{ team.name }}" class="team-logo-large">
              </div>
              {% endif %}
            </div>
            <div class="team-details">
              <ul>
                <li><strong>Nationality:</strong> {{ team.nationality }}</li>
                <li><strong>Championship Position:</strong> {{ team.position or 'â€”' }}</li>
                <li><strong>Points:</strong> {{ team.points or 'â€”' }}</li>
                <li><strong>Wins:</strong> {{ team.wins or 'â€”' }}</li>
                <li><strong>URL:</strong>
                  <a href="{{ team.url }}" target="_blank" rel="noopener noreferrer">{{ team.url }}</a>
                </li>
              </ul>
            </div>
          </div>
          {% else %}
          <p>{{ user.favorite_team or "No favorite team set." }}</p>
          {% endif %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/profile.js') }}"></script>
</body>

</html>
